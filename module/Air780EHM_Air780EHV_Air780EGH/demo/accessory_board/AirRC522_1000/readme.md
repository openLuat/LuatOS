## 功能模块介绍：

1. main.lua：主程序入口

2. rc522.lua ：rc522扩展库文件，在AirRC522_1000.lua功能模块中require使用

3. AirRC522_1000.lua：功能演示核心文件，在main.lua中加载运行，详细逻辑请看AirRC522_1000.lua 文件

## 演示功能概述：

核心逻辑：

1. 初始化并启用spi,如果初始化失败，退出程序

2. 初始化RC522模块,如果初始化失败，退出程序

3. 循环检测卡片。

4. 向卡片指定块号写入数据，并读取数据验证一致性

5. 读取卡片所有数据

## 演示硬件环境：

![](https://docs.openluat.com/accessory/AirSPINORFLASH_1000/image/780EHV.jpg)

![](https://docs.openluat.com/accessory/AirSPINORFLASH_1000/image/rc522.jpg)

1. 合宙 Air780EHM/EHV/EGH 核心板一块

2. 合宙 AirRC522_1000 一套

3. TYPE-C USB 数据线一根 ，Air780EHV/EHM/EGH 核心板和数据线的硬件接线方式为：
* Air780EHV/EHM/EGH核心板通过 TYPE-C USB 口供电；（USB的拨码开关off/on,拨到on）

* TYPE-C USB 数据线直接插到核心板的 TYPE-C USB 座子，另外一端连接电脑 USB 口；
4. 杜邦线 7根
   Air780EHV/EHM/EGH 核心板与 AirRC522_1000 按以下方式接线：

| Air780EHV/EHM/EGH核心板                         | AirRC522_1000 |
| -------------------------------------------- | ------------- |
| GND(任意)                                      | GND           |
| 3V3                                          | 3.3V          |
| 83/SPI0CS                                    | SDA           |
| 86/SPI0CLK                                   | SCK           |
| 85/SPI0MOSI                                  | MOSI          |
| 84/SPI0MISO                                  | MISO          |
| GPIO22(可选任意空闲IO) | RST           |

## 演示软件环境：

1. Luatools 下载调试工具

2. 固件版本：LuatOS-SoC_V2018_Air780EHM_1，固件地址，如有最新固件请用最新 [https://docs.openluat.com/air780ehm/luatos/firmware/version/](https://docs.openluat.com/air780ehm/luatos/firmware/version/)

3. 固件版本：LuatOS-SoC_V2018_Air780EHV_1，固件地址，如有最新固件请用最新 [https://docs.openluat.com/Air780EHV/luatos/firmware/version/](https://docs.openluat.com/air780ehv/luatos/firmware/version/)

4. 固件版本：LuatOS-SoC_V2018_Air780EGH_1，固件地址，如有最新固件请用最新 [https://docs.openluat.com/air780egh/luatos/firmware/version/](https://docs.openluat.com/air780egh/luatos/firmware/version/)

5. pc 系统 win11（win10 及以上）

## 演示核心步骤：

1. 搭建好硬件环境

2. Luatools 烧录内核固件和demo 脚本代码.
   AirRC522_1000.lua脚本中,硬件配置参数中rst_pin是使用Air780EHV/EHM/EGH核心板的GPIO22，如果接其他IO，注意修改硬件配置参数中rst_pin对应的管脚号。

3. 烧录成功后，代码会自动运行，查看打印日志，如果正常运行，会打印相关信息，spi 初始化，rc522初始化，写入数据读取数据等。

4. 如下 log 显示：

```
[2025-12-01 18:17:19.642][000000000.252] I/user.main Air780EHM/EHV/EGH_rc522_DEMO 001.000.000
[2025-12-01 18:17:19.648][000000000.274] I/user.RC522 初始化SPI接口
[2025-12-01 18:17:19.654][000000000.274] SPI_HWInit 552:spi0 speed 2000000,1994805,154
[2025-12-01 18:17:19.661][000000000.275] I/user.RC522 SPI初始化成功
[2025-12-01 18:17:19.668][000000000.275] I/user.RC522 初始化RC522传感器
[2025-12-01 18:17:19.681][000000000.277] D/user.rc522.version 178
[2025-12-01 18:17:19.694][000000000.278] I/user.RC522 传感器初始化成功
[2025-12-01 18:17:19.705][000000000.278] I/user.RC522 开始检测卡片
[2025-12-01 18:17:19.715][000000000.283] I/user.RC522 检测到卡片，类型： 0400 4
[2025-12-01 18:17:19.723][000000000.290] I/user.RC522 卡片UID： E3E2AD14 8
[2025-12-01 18:17:19.736][000000000.379] I/user.RC522 数据写入成功，块号: 9 写入数据是： 01000000000000000000000000000000 32
[2025-12-01 18:17:19.744][000000000.417] I/user.RC522 写入验证成功，数据是: 01000000000000000000000000000000 32
[2025-12-01 18:17:19.754][000000000.418] I/user.RC522 开始读取卡片数据...
[2025-12-01 18:17:19.764][000000000.473] I/user.块[0] E3E2AD14B80804006263646566676869 32
[2025-12-01 18:17:19.773][000000000.553] I/user.块[1] 00000000000000000000000000000000 32
[2025-12-01 18:17:19.864][000000000.642] I/user.块[2] 00000000000000000000000000000000 32
[2025-12-01 18:17:19.881][000000000.715] I/user.块[3] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:20.063][000000000.813] I/user.块[4] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.071][000000000.891] I/user.块[5] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.083][000000001.010] I/user.块[6] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.098][000000001.076] I/user.块[7] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:20.109][000000001.141] I/user.块[8] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.118][000000001.206] I/user.块[9] 01000000000000000000000000000000 32
[2025-12-01 18:17:20.181][000000001.273] I/user.块[10] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.244][000000001.339] I/user.块[11] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:20.308][000000001.404] I/user.块[12] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.370][000000001.469] I/user.块[13] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.448][000000001.534] I/user.块[14] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.510][000000001.599] I/user.块[15] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:20.573][000000001.665] I/user.块[16] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.735][000000001.719] D/mobile cid1, state0
[2025-12-01 18:17:20.745][000000001.720] D/mobile bearer act 0, result 0
[2025-12-01 18:17:20.759][000000001.721] D/mobile NETIF_LINK_ON -> IP_READY
[2025-12-01 18:17:20.773][000000001.753] I/user.块[17] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.785][000000001.758] D/mobile TIME_SYNC 0
[2025-12-01 18:17:20.795][000000001.819] I/user.块[18] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.806][000000001.884] I/user.块[19] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:20.850][000000001.949] I/user.块[20] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.928][000000002.014] I/user.块[21] 00000000000000000000000000000000 32
[2025-12-01 18:17:20.990][000000002.080] I/user.块[22] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.054][000000002.145] I/user.块[23] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:21.116][000000002.210] I/user.块[24] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.180][000000002.276] I/user.块[25] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.256][000000002.345] I/user.块[26] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.318][000000002.410] I/user.块[27] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:21.382][000000002.475] I/user.块[28] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.443][000000002.540] I/user.块[29] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.507][000000002.605] I/user.块[30] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.585][000000002.670] I/user.块[31] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:21.648][000000002.736] I/user.块[32] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.711][000000002.801] I/user.块[33] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.774][000000002.866] I/user.块[34] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.835][000000002.932] I/user.块[35] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:21.912][000000002.998] I/user.块[36] 00000000000000000000000000000000 32
[2025-12-01 18:17:21.976][000000003.064] I/user.块[37] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.038][000000003.129] I/user.块[38] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.102][000000003.194] I/user.块[39] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:22.164][000000003.259] I/user.块[40] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.240][000000003.324] I/user.块[41] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.303][000000003.389] I/user.块[42] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.365][000000003.454] I/user.块[43] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:22.429][000000003.519] I/user.块[44] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.491][000000003.584] I/user.块[45] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.554][000000003.649] I/user.块[46] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.615][000000003.714] I/user.块[47] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:22.696][000000003.779] I/user.块[48] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.757][000000003.844] I/user.块[49] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.817][000000003.909] I/user.块[50] 00000000000000000000000000000000 32
[2025-12-01 18:17:22.879][000000003.974] I/user.块[51] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:22.942][000000004.040] I/user.块[52] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.018][000000004.105] I/user.块[53] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.080][000000004.170] I/user.块[54] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.142][000000004.235] I/user.块[55] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:23.205][000000004.300] I/user.块[56] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.267][000000004.366] I/user.块[57] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.346][000000004.431] I/user.块[58] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.407][000000004.497] I/user.块[59] 000000000000FF078069FFFFFFFFFFFF 32
[2025-12-01 18:17:23.467][000000004.562] I/user.块[60] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.530][000000004.627] I/user.块[61] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.607][000000004.692] I/user.块[62] 00000000000000000000000000000000 32
[2025-12-01 18:17:23.669][000000004.757] I/user.块[63] 000000000000FF078069FFFFFFFFFFFF 32

```
