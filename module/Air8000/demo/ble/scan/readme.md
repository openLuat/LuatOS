## 功能介绍

1、main.lua：主程序入口；

2、ble_scan.lua文件为演示scan功能的代码文件，主要功能为：

- 初始化蓝牙

- 创建BLE对象

- 设置扫描模式

- 开始扫描

- 在回调函数中处理扫描事件

- 按需停止扫描

3、check_wifi.lua：检查当前Air8000模组的WiFi固件是否为最新版本，若不是则自动启动升级（需插入可联网的SIM卡）。

4、ble_lowpower.lua：控制WiFi和蓝牙的开启和关闭，默认WiFi和蓝牙都是开启状态，无需控制。

## 演示功能概述

使用Air8000核心板，演示Air8000蓝牙在观察者模式下扫描蓝牙设备的操作。

## 演示硬件环境

1、Air8000核心板一块

2、TYPE-C USB数据线一根

3、Air8000核心板和数据线的硬件接线方式为

- Air8000核心板通过TYPE-C USB口供电；（正常测试时核心板背面的功耗测试开关拨到ON，正面的白色拨码(供电,充电选择脚)开关拨到供电.）

- TYPE-C USB数据线直接插到核心板的TYPE-C USB座子，另外一端连接电脑USB口；

## 演示软件环境

1、Luatools下载调试工具

[如何使用 LuaTools 烧录软件 - luatos@air8000 - 合宙模组资料中心](https://docs.openluat.com/air8000/luatos/common/download/)

2、[Air8000 V2018版本固件](https://docs.openluat.com/air8000/luatos/firmware/)

## 演示核心步骤

1、搭建好演示硬件环境

2、Luatools烧录内核固件和demo脚本代码

3、烧录成功后，自动开机运行，如果设备出现以下日志，表示scan已启动

```
I/user.ble_scan scan init
```

4、扫描到的蓝牙设备信息会在日志中打印出来，可以自己根据需要修改打印的设备信息。

例如下面这条打印，扫描到了一个广播包，广播包的RSSI为-53dBm，广播包的MAC地址为1E10BA37603C，广播包的广播数据为1EFF060001092022F866C970A5405607E9ABC4E2D1E23E53488A469EB48501，广播包的广播数据长度为62字节。

```
D/user.ble_scan scan report -53 1E10BA37603C 1EFF060001092022F866C970A5405607E9ABC4E2D1E23E53488A469EB48501 62
```

5、演示ble_lowpower.lua模块的功能

- 控制WiFi和蓝牙的开启和关闭

- 默认WiFi和蓝牙都是开启状态，无需控制

- 每300秒关闭一次WiFi，再开启一次WiFi

如果关闭了WiFi和蓝牙后，Luatools将打印airlink slave timeout，表示Air8000的4G部分和WiFi协处理器通信超时：

```lua
D/airlink slave timeout
```

下面是演示打开ble_lowpower模块后的日志：

```lua
[2026-01-23 14:15:16.104][000000000.241] D/airlink open airlink for air8000s
[2026-01-23 14:15:16.110][000000000.438] I/airlink AIRLINK_READY 438 version 18 t 241
[2026-01-23 14:15:16.121][000000000.439] D/airlink Air8000s启动完成, 等待了 197 ms
[2026-01-23 14:15:16.125][000000000.467] I/user.main project name is  ble_scan version is  001.000.000
[2026-01-23 14:15:16.132][000000000.487] D/drv.bt 执行luat_bluetooth_init
[2026-01-23 14:15:16.136][000000000.488] I/user.ble_scan 开始扫描
[2026-01-23 14:15:16.141][000000000.532] I/user.ble_scan scan init
[2026-01-23 14:15:16.147][000000000.546] I/user.ble_scan 发现设备 RSSI: -77 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:16.149][000000000.567] I/user.ble_scan 发现设备 RSSI: -69 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:17.278][000000002.580] I/user.ble_scan 发现设备 RSSI: -67 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:17.293][000000002.582] I/user.ble_scan 发现设备 RSSI: -76 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:18.252][000000003.553] I/user.ble_scan 发现设备 RSSI: -77 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:19.251][000000004.555] I/user.ble_scan 发现设备 RSSI: -69 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:20.291][000000005.592] I/user.ble_scan 发现设备 RSSI: -77 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:20.305][000000005.604] I/user.ble_scan 发现设备 RSSI: -67 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:21.254][000000006.556] I/user.ble_scan 发现设备 RSSI: -78 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:22.301][000000007.603] I/user.ble_scan 发现设备 RSSI: -69 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:23.248][000000008.550] I/user.ble_scan 发现设备 RSSI: -67 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:23.298][000000008.602] I/user.ble_scan 发现设备 RSSI: -77 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:24.259][000000009.560] I/user.ble_scan 发现设备 RSSI: -79 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:24.318][000000009.602] I/user.ble_scan 发现设备 RSSI: -69 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:25.174][000000010.476] I/pm pm
[2026-01-23 14:15:25.198][000000010.477] I/user.ble_lowpower 发布: WiFi状态 -> 0
[2026-01-23 14:15:25.230][000000010.477] I/user.ble_scan 收到WiFi状态变化: 0
[2026-01-23 14:15:25.247][000000010.488] I/user.ble_scan 检测到扫描异常，准备重新初始化
[2026-01-23 14:15:25.266][000000010.488] I/user.ble_scan 等待5秒后重新尝试...
[2026-01-23 14:15:30.186][000000015.489] I/user.ble_scan WiFi关闭，等待WiFi开启...
[2026-01-23 14:15:32.187][000000017.489] I/user.ble_scan 等待5秒后重新尝试...
[2026-01-23 14:15:35.175][000000020.477] I/pm pm
[2026-01-23 14:15:35.204][000000020.477] I/user.ble_lowpower 发布: WiFi状态 -> 1
[2026-01-23 14:15:35.236][000000020.478] I/user.ble_scan 收到WiFi状态变化: 1
[2026-01-23 14:15:37.185][000000022.489] D/drv.bt 执行luat_bluetooth_init
[2026-01-23 14:15:37.233][000000022.490] I/user.ble_scan 开始扫描
[2026-01-23 14:15:37.258][000000022.529] I/user.ble_scan scan init
[2026-01-23 14:15:37.276][000000022.568] I/user.ble_scan 发现设备 RSSI: -68 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:38.283][000000023.585] I/user.ble_scan 发现设备 RSSI: -78 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:39.261][000000024.562] I/user.ble_scan 发现设备 RSSI: -78 地址: 5B349929E6E7 数据: 02010217FF8F031D1134384779103041A2011526290189570103020303AAFD 62
[2026-01-23 14:15:39.299][000000024.574] I/user.ble_scan 发现设备 RSSI: -67 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62
[2026-01-23 14:15:40.303][000000025.607] I/user.ble_scan 发现设备 RSSI: -69 地址: 2C4D179A1E2E 数据: 1EFF060001092022A9A08423EE442B90E451623B7478F051C7BC4142ED31E9 62

```