## 功能模块介绍：

1、main.lua：主程序入口；

2、netdrv_device.lua：网卡驱动设备，可以配置使用netdrv文件夹内的四种网卡(单4g网卡，单wifi网卡，单spi以太网卡，多网卡)中的任何一种网卡；

3、netdrv文件夹：四种网卡，单4g网卡、单wifi网卡，、单spi以太网卡、多网卡，供netdrv_device.lua加载配置；

4、ntp_test.lua:   功能演示核心脚本，联网、时间同步、获取时间等,在main.lua中加载运行。

## 演示功能概述：

1.判断是否联网

2.网络就绪后开始时间同步

3.时间同步成功，获取本地时间和UTC时间，循环默认时间打印一次

4.时间同步失败，进行重试获取



## 演示硬件环境

![netdrv_multi](https://docs.openluat.com/air8000/luatos/app/image/netdrv_multi.jpg)



1、Air8000开发板一块+可上网的sim卡一张+4g天线一根+wifi天线一根+网线一根：

* sim卡插入开发板的sim卡槽

* 天线装到开发板上

* 网线一端插入开发板网口，另外一端连接可以上外网的路由器网口

2、TYPE-C USB数据线一根 ，Air8000开发板和数据线的硬件接线方式为：

* Air8000开发板通过TYPE-C USB口供电；（外部供电/USB供电 拨动开关 拨到 USB供电一端）

* TYPE-C USB数据线直接插到开发板的TYPE-C USB座子，另外一端连接电脑USB口；

## 演示软件环境

1、 Luatools下载调试工具

2、 固件版本：LuatOS-SoC_V2016_Air8000_1，固件地址，如有最新固件请用最新 [https://docs.openluat.com/air8000/luatos/firmware/](https://docs.openluat.com/air8000/luatos/firmware/)

3、 脚本文件：
   main.lua

   ntp_test.lua

   netdrv_device.lua

   netdrv文件夹

4、 pc 系统 win11（win10 及以上）



## 演示核心步骤

1、搭建好硬件环境

2、demo脚本代码netdrv_device.lua中，按照自己的网卡需求启用对应的Lua文件

* 如果需要单4G网卡，打开require "netdrv_4g"，其余注释掉

* 如果需要单WIFI STA网卡，打开require "netdrv_wifi"，其余注释掉；同时netdrv_wifi.lua中的wlan.connect("茶室-降功耗,找合宙!", "Air123456", 1)，前两个参数，修改为自己测试时wifi热点的名称和密码；注意：仅支持2.4G的wifi，不支持5G的wifi

* 如果需要以太网卡，打开require "netdrv_eth_spi"，其余注释掉

* 如果需要多网卡，打开require "netdrv_multiple"，其余注释掉；同时netdrv_multiple.lua中的ssid = "茶室-降功耗,找合宙!", password = "Air123456", 修改为自己测试时wifi热点的名称和密码；注意：仅支持2.4G的wifi，不支持5G的wifi

3、如果使用自定义NTP服务器 地址，脚本文件ntp_test.lua中，在CONFIG表中ntp_servers表修改为自己的服务器地址。

4、Luatools烧录内核固件和修改后的demo脚本代码

5、烧录成功后，代码会自动运行，查看打印日志，如果正常运行，会打印ftp登录成功，空操作和文件目录打印，上传下载文件结果以及关闭FTP连接等信息，如下log显示：

```
[2025-10-23 17:33:58.725][000000000.677] I/user.main ntp_demo 001.000.000
[2025-10-23 17:33:59.712][000000001.941] D/mobile cid1, state0
[2025-10-23 17:33:59.731][000000001.941] D/mobile bearer act 0, result 0
[2025-10-23 17:33:59.754][000000001.942] D/mobile NETIF_LINK_ON -> IP_READY
[2025-10-23 17:33:59.767][000000001.943] I/user.netdrv_4g.ip_ready_func IP_READY 100.85.9.51 255.255.255.255 0.0.0.0 nil
[2025-10-23 17:33:59.784][000000001.943] I/user.sntp 网络就绪，开始时间同步流程
[2025-10-23 17:33:59.796][000000001.944] I/user.sntp 开始同步：
[2025-10-23 17:33:59.812][000000001.946] D/sntp query ntp.aliyun.com
[2025-10-23 17:33:59.822][000000001.947] dns_run 676:ntp.aliyun.com state 0 id 1 ipv6 0 use dns server2, try 0
[2025-10-23 17:33:59.837][000000001.979] dns_run 693:dns all done ,now stop
[2025-10-23 17:33:59.849][000000001.986] D/mobile TIME_SYNC 0
[2025-10-23 17:33:59.861][000000001.987] I/user.sntp 时间同步成功
[2025-10-23 17:33:59.873][000000001.988] I/user.sntp 本地时间字符串 Thu Oct 23 17:33:59 2025
[2025-10-23 17:33:59.887][000000001.989] I/user.sntp UTC时间字符串 Thu Oct 23 09:33:59 2025
[2025-10-23 17:33:59.904][000000001.989] I/user.sntp 格式化本地时间字符串 2025-10-23 17:33:59
[2025-10-23 17:33:59.922][000000001.990] I/user.sntp 格式化UTC时间字符串 2025-10-23 09:33:59
[2025-10-23 17:33:59.936][000000001.991] I/user.sntp RTC时钟(UTC) {"year":2025,"min":33,"hour":9,"mon":10,"sec":59,"day":23}
[2025-10-23 17:33:59.949][000000001.991] I/user.sntp 本地时间戳 1761212039
[2025-10-23 17:33:59.965][000000001.992] I/user.sntp 本地时间结构 {"wday":5,"min":33,"yday":296,"hour":17,"isdst":false,"year":2025,"month":10,"sec":59,"day":23}
[2025-10-23 17:33:59.980][000000001.993] I/user.sntp 结构时间转时间戳 1761240839
[2025-10-23 17:33:59.994][000000001.993] I/user.tm数据 {"sms":0,"tms":993,"tsec":1,"lms":993,"ndeley":0,"lsec":1,"ssec":0}
[2025-10-23 17:34:00.013][000000001.994] I/user.sntp 高精度时间戳 1.993
[2025-10-23 17:34:00.037][000000002.040] D/sntp Unix timestamp: 1761212039
[2025-10-23 17:34:14.698][000000016.994] I/user.sntp 开始同步：
[2025-10-23 17:34:14.718][000000016.995] D/sntp query ntp.aliyun.com
[2025-10-23 17:34:14.740][000000016.995] dns_run 676:ntp.aliyun.com state 0 id 2 ipv6 0 use dns server2, try 0
[2025-10-23 17:34:14.838][000000017.130] dns_run 693:dns all done ,now stop
[2025-10-23 17:34:14.901][000000017.203] D/sntp 修正网络延时(ms) 0 -> 36
[2025-10-23 17:34:14.921][000000017.203] D/sntp Unix timestamp: 1761212055
[2025-10-23 17:34:14.930][000000017.204] I/user.sntp 时间同步成功
[2025-10-23 17:34:14.940][000000017.205] I/user.sntp 本地时间字符串 Thu Oct 23 17:34:15 2025
[2025-10-23 17:34:14.948][000000017.205] I/user.sntp UTC时间字符串 Thu Oct 23 09:34:15 2025
[2025-10-23 17:34:14.958][000000017.206] I/user.sntp 格式化本地时间字符串 2025-10-23 17:34:15
[2025-10-23 17:34:14.966][000000017.207] I/user.sntp 格式化UTC时间字符串 2025-10-23 09:34:15
[2025-10-23 17:34:14.973][000000017.207] I/user.sntp RTC时钟(UTC) {"year":2025,"min":34,"hour":9,"mon":10,"sec":15,"day":23}
[2025-10-23 17:34:14.981][000000017.208] I/user.sntp 本地时间戳 1761212055
[2025-10-23 17:34:14.991][000000017.208] I/user.sntp 本地时间结构 {"wday":5,"min":34,"yday":296,"hour":17,"isdst":false,"year":2025,"month":10,"sec":15,"day":23}
[2025-10-23 17:34:15.001][000000017.209] I/user.sntp 结构时间转时间戳 1761240855
[2025-10-23 17:34:15.012][000000017.210] I/user.tm数据 {"sms":66,"tms":275,"vaild":true,"tsec":1761212054,"lms":209,"ndeley":36,"lsec":17,"ssec":1761212037}
[2025-10-23 17:34:15.023][000000017.210] I/user.sntp 高精度时间戳 1761212054.275

```
