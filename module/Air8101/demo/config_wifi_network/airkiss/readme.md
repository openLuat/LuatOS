## 功能模块介绍

1、main.lua：主程序入口，负责初始化系统环境和加载airkiss_task模块；

2、airkiss_task.lua：AirKiss配网功能实现模块，演示如何使用AirKiss协议进行WIFI配网；

## 演示功能概述

1、airkiss_task：演示如何通过AirKiss协议实现WIFI配网功能
   - 启动AirKiss配网，支持手机APP发送WIFI信息
   - 配网成功后将WIFI信息保存到fskv持久化存储
   - 重启后自动读取配网信息并连接WIFI网络
   - 支持IP获取成功的事件通知

AirKiss配网的主要功能特性：

1、**简单易用**：只需几行代码即可实现完整的配网流程；

2、**持久化存储**：配网信息保存到fskv，掉电不丢失，刷脚本/固件也不会清除；

3、**自动重连**：设备重启后自动读取配网信息并连接WIFI；

4、**事件通知**：通过"IP_READY"和"SC_RESULT"消息通知配网和联网状态；

5、**超时处理**：配网超时后自动重新尝试；

## 演示硬件环境

1、Air8101核心板一块

2、TYPE-C USB数据线一根

3、Air8101核心板和数据线的硬件接线方式为

- Air8101核心板通过TYPE-C USB口供电；（核心板背面的功耗测试开关拨到OFF一端）

- 如果测试发现软件频繁重启，重启原因值为：poweron reason 0，可能是供电不足，此时再通过直流稳压电源对核心板的vbat管脚进行4V供电，或者VIN管脚进行5V供电；

- TYPE-C USB数据线直接插到核心板的TYPE-C USB座子，另外一端连接电脑USB口；

## 演示软件环境

1、Luatools下载调试工具

2、[Air8101 固件](https://docs.openluat.com/air8101/luatos/firmware/)

## 演示核心步骤

1、搭建好硬件环境，确保开发板能正常供电；

2、AirKiss配网操作步骤：

- 将Air8101核心板通过TYPE-C USB数据线连接到电脑；

- 使用Luatools将demo脚本下载到Air8101核心板；

- 下载完成后，Air8101核心板会自动重启并开始执行AirKiss配网程序；

- 微信公众号或者微信小程序搜索"AirKiss 配网"，本demo选用"巴法科技(深圳)有线公司"的"一键配网"小程序来进行AirKiss 配网；

- 在小程序中选择"AirKiss 配网"，输入家庭WIFI密码，然后点击"下一步"；

- 将手机靠近Air8101核心板，保持手机屏幕亮屏，等待配网完成；

- 配网成功后，设备会自动保存配网信息并重启；

- 重启后，设备会自动连接到刚才配置的WIFI网络；

3、通过Luatools工具，可以查看设备的运行日志，包括配网状态和联网信息：

```lua
[2025-05-27 14:30:21.571][000000000.689] I/user.main AirKiss 1.0.0
[2025-05-27 14:30:22.124][000000001.135] I/user.wlan 启动airkiss
[2025-05-27 14:30:35.236][000000014.255] I/user.airkiss 配网成功 MyWiFi 12345678
[2025-05-27 14:30:35.237][000000014.256] I/user.smartconfig MyWiFi 12345678
[2025-05-27 14:30:35.238][000000014.257] I/user.fskv save ssid and passwd
[2025-05-27 14:30:35.239][000000014.258] I/user.wifi wait 3s to reboot
[2025-05-27 14:30:38.240][000000017.265] I/user.main AirKiss 1.0.0
[2025-05-27 14:30:38.756][000000017.777] I/user.wlan ip ready 192.168.1.100
```

4、注意事项：

- AirKiss配网仅支持2.4G WIFI，不支持5G WIFI；

- 有些中文WIFI会无法配网成功，请将WiFi名称修改为英文；

- 配网时请确保手机和设备距离较近，信号良好；

- 配网信息保存在fskv中，如需清除配置信息，可以调用fskv.clear()函数；

- 如果需要重新配网，可以先调用fskv.clear()清除配置信息，然后重启设备；

- 配网超时时间为3分钟，超时后会自动重新尝试配网；