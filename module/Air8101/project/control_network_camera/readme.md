## 演示功能概述

### 1.1 网络摄像头控制系统概述

网络摄像头控制系统是一种基于Air8101模组的轻量级摄像头控制解决方案，通过连接WiFi网络，实现对网络摄像头的OSD文字显示设置和拍照功能。

### 1.2 系统工作原理

设备启动后，自动连接指定的WiFi网络，初始化SD卡挂载。然后控制网络摄像头，设置OSD文字显示并进行拍照操作，照片保存在SD卡中。

### 1.3 核心功能特性

- **自动联网**：设备自动连接指定的WiFi网络
- **SD卡管理**：自动挂载SD卡，用于存储摄像头拍摄的照片
- **OSD控制**：设置摄像头的OSD文字显示内容和位置
- **远程拍照**：控制网络摄像头进行拍照，并将照片保存到SD卡

本示例基于合宙 Air8101 模组，演示 **STA + 网络摄像头控制** 的完整实现流程。设备连接到WiFi网络后，自动控制网络摄像头进行OSD设置和拍照操作。

#### 1、系统启动流程

- **初始化阶段**：系统启动后，自动连接指定的WiFi网络
- **环境准备**：联网成功后，自动挂载SD卡，为拍照功能做准备
- **摄像头控制**：设置摄像头的OSD文字显示内容和位置
- **拍照操作**：控制网络摄像头进行拍照，照片保存在SD卡中

#### 2、WiFi连接配置

使用 wlan.connect() 连接指定的WiFi网络，默认配置为名称"@PHICOMM_75"，密码"li19760705"。

#### 3、SD卡初始化与挂载

- 设置GPIO13为高电平，为SD卡供电
- 将SD卡挂载到文件系统，挂载点为`/sd`
- 用于存储摄像头拍摄的照片

#### 4、摄像头控制功能

- **OSD设置**：设置摄像头的OSD文字显示内容和位置
- **拍照功能**：控制摄像头进行拍照，照片保存为`/sd/1.jpeg`

#### 5、运行效果

- **WiFi连接成功**：设备成功连接到指定的WiFi网络
- **SD卡挂载成功**：SD卡成功挂载到文件系统
- **OSD设置完成**：摄像头的OSD文字显示设置成功
- **拍照成功**：照片成功保存到SD卡中

## 演示硬件环境

![](https://docs.openluat.com/air8101/luatos/app/image/8101-AirMICROSD_1000.jpg)

1、Air8101核心板一块

2、TYPE-C USB数据线一根，Air8101核心板和数据线的硬件接线方式为：

- Air8101核心板通过TYPE-C USB口供电；（外部供电/USB供电 拨动开关 拨到 USB供电一端）
- TYPE-C USB数据线直接插到核心板的TYPE-C USB座子，另外一端连接电脑USB口；

3、AirMICROSD_1000配件板一个+micro SD卡一张

4、Air8101核心板与AirMICROSD_1000配件板直插，对应管脚为

| Air8101核心板 | AirMICROSD_1000配件板 |
| ------------- | ----------------- |
| 59/3V3        | 3V3               |
| gnd           | gnd               |
| 9/GPIO6       | CD                |
| 67/GPIO4      | D0                |
| 66/GPIO3      | CMD               |
| 65/GPIO2      | CLK               |

5、支持OSD功能的网络摄像头一台（目前仅支持大华摄像头）

## 演示软件环境

1、Luatools下载调试工具

2、Air8101固件[Air8101 版本固件](https://docs.openluat.com/air8101/luatos/firmware/)（需确保固件版本≥V2001）

## 演示核心步骤

1、搭建好硬件环境，确保Air8101核心板和网络摄像头连接同一WiFi网络。

2、如果需要测试SD卡功能，需要外挂SD卡来测试。

3、通过Luatools将本工程代码与固件烧录到Air8101核心板中

4、烧录完成后，给设备上电，观察串口日志确认系统正常启动

系统启动日志示例：

```lua
[2025-12-30 15:45:09.929] luat:U(2090):I/user.main CONTROL_NETWORK_CAMERA 001.000.000
[2025-12-30 15:45:09.960] luat:U(2113):I/user.执行STA连接操作
[2025-12-30 15:45:12.007] luat:D(4165):wlan:STA connected @PHICOMM_75 
[2025-12-30 15:45:12.279] luat:U(4434):I/user.SDCARD 挂载SD卡结果: true
[2025-12-30 15:45:12.279] luat:U(4436):I/user.开始运行OSD操作
[2025-12-30 15:45:12.279] luat:U(4436):I/user.osdsetup 检测到大华摄像头，开始初始化
[2025-12-30 15:45:12.279] luat:U(4438):I/user.元素解析 索引 1 值 1111
[2025-12-30 15:45:12.279] luat:U(4439):I/user.元素解析 索引 2 值 2222
[2025-12-30 15:45:12.279] luat:U(4439):I/user.元素解析 索引 3 值 3333
[2025-12-30 15:45:12.279] luat:U(4440):I/user.元素解析 索引 4 值 4444
[2025-12-30 15:45:12.279] luat:U(4440):I/user.元素解析 索引 5 值 5555
[2025-12-30 15:45:12.292] luat:U(4441):I/user.元素解析 索引 6 值 6666
[2025-12-30 15:45:12.292] luat:D(4449):net:adapter 2 connect 192.168.1.108:80 TCP
[2025-12-30 15:45:16.708] luat:U(8863):I/user.DHosd 第一次请求http，code： 401 table: 609B1CB8
[2025-12-30 15:45:16.708] luat:U(4303):l/user.DigestAuth 鉴权信息重组完成
[2025-12-30 15:45:16.708] luat:U(8863):I/user.DHosd 第二次请求http，code:200 OK
[2025-12-30 15:45:17.695] luat:U(9864):I/user.开始运行抓图操作
[2025-12-30 15:45:17.695] luat:U(9865):I/user.getphoto 检测到大华摄像头，开始初始化
[2025-12-30 15:45:17.695] luat:U(9865):I/user.DHPicture 开始执行
[2025-12-30 15:45:17.695] luat:D(9869):net:adapter 2 connect 192.168.1.108:80 TCP
[2025-12-30 15:45:18.695] luat:U(5406):/user.DHPicture 第一次请求http,code: 401 table: 609AFFBO
[2025-12-30 15:45:18.695] luat:U(5408):l/user.DigestAuth 鉴权信息重组完成
[2025-12-30 15:45:18.695] luat:U(5408):/user.DHPicture 鉴权信息重组完成
[2025-12-30 15:45:18.695] luat:U(8224):l/user.DHPicture 第二次请求http，code: 200
[2025-12-30 15:45:19.413] luat:U(8256):l/user.DHpicture 拍照完成
```

5、拍照完成后，照片保存在SD卡中，路径为`/sd/1.jpeg`

## 系统参数说明

### WiFi参数

- SSID：@PHICOMM_75（可在init_app.lua中修改）
- 密码：li19760705（可在init_app.lua中修改）

### 摄像头参数

- 品牌：Dhua（大华）
- IP地址：192.168.1.108（可在cam_control.lua中修改）
- 通道号：0（OSD设置），1（拍照）
- OSD内容：1111|2222|3333|4444|5555|6666（可在cam_control.lua中修改）
- OSD位置：X=0, Y=2000（可在cam_control.lua中修改）

### 存储参数

- 照片路径：/sd/1.jpeg
- 存储介质：SD卡（需FAT32格式）

## 注意事项

1、确保Air8101核心板和网络摄像头连接同一WiFi网络

2、如需修改WiFi名称、密码或摄像头参数，请修改init_app.lua和cam_control.lua中的相关参数

3、拍照前请确保SD卡已成功挂载，否则照片无法保存

4、OSD文字内容需用竖线分隔，格式如"1111|2222|3333|4444"