# iRTU 项目模块接口详细说明

## 主程序入口模块 (main.lua)

**核心函数：**

- `sys.run()`- 启动系统任务调度器，进入主循环

**功能分析：**

这个模块是程序的启动入口，通过定义全局变量和加载系统模块来搭建基础环境。看门狗配置确保系统稳定性，防止程序卡死。

## 主程序协调模块 (irtu_main.lua)

**核心函数：**

- 模块初始化序列函数调用

**功能分析：**

作为系统协调中心，通过严格的初始化顺序确保模块间正确依赖。使用 `sys.taskInit` 创建系统任务，管理各功能模块的生命周期。

## 音频系统模块 (audio_config.lua)

**核心函数：**

- `audio_config.init()`- 音频系统初始化
- `audio_config.audio_play_tts()`- TTS 文本转语音播放
- `audio_config.audio_play_file()`- 音频文件播放
- `audio_config.result()`- 播放结果查询
- `play_end()`- 播放完成回调处理

**功能分析：**

提供完整的音频播放解决方案，支持多种播放模式和音频格式。通过回调机制实现播放状态监控，支持远程文件下载和本地文件管理。

## 网络连接管理模块 (create.lua)

**核心函数：**

- `create.start()`- 启动网络服务
- `tcpTask()`- TCP/UDP 连接任务
- `mqttTask()`- MQTT 客户端任务
- `aircloudTask()`- AirCloud 云平台连接
- `conver()`- 数据格式转换
- `loginMsg()`- 生成登录报文
- `create.getDatalink()`- 网络连接状态查询
- `create.getADC()`- ADC 数据采集
- `create.getRealLocation()`- 实时位置获取
- `create.userapi()`- 用户 API 接口处理

**功能分析：**

作为系统通信核心，支持多种网络协议和完整的连接管理。提供数据协议转换和设备信息处理，确保网络通信的稳定性和灵活性。

## 配置管理模块 (default.lua)

**核心函数：**

- `default.init()`- 配置系统初始化
- `default.get()`- 获取当前配置
- `config_init()`- 远程配置初始化
- `load_task()`- 加载用户任务

**功能分析：**

负责系统参数管理和持久化存储，支持远程配置更新和固件 OTA 升级。提供灵活的配置适配机制，满足不同应用场景需求。

## 设备驱动模块 (driver.lua)

**核心函数：**

- `driver.init()`- 驱动系统初始化
- `write()`- 串口数据发送
- `read()`- 串口数据接收处理
- `uart_INIT()`- 串口初始化配置
- `autoSampl()`- 自动采集任务
- `netled()`- 网络指示灯控制
- `driver.setLocation()`- 位置信息设置

**功能分析：**

直接与硬件交互，提供完整的设备控制能力。支持丰富的远程控制命令集，实现设备状态监控和硬件控制功能。

## GPS 定位模块 (gnss.lua)

**核心函数：**

- `gnss.init()`- 定位系统初始化
- `alert()`- 主定位任务
- `locateMessage()`- 定位数据格式化
- `gnss_state()`- 定位状态监控
- `eff_vib()`- 有效震动处理
- `ind()`- 震动中断检测

**功能分析：**

提供多种定位工作模式，支持震动触发和定时定位。具备智能功耗管理，通过 AGPS 加速定位，实现高效的定位数据采集和处理。

## 配置文件结构 (irtu.cfg)

**配置段分析：**

- 网络配置段：定义服务器连接参数
- 串口配置段：设置通信参数
- 功能开关：控制系统各模块工作状态
- 硬件参数：GPIO 映射和电源管理配置

**功能分析：**

采用 JSON 格式的配置文件，支持远程更新和动态生效。提供完整的参数管理机制，满足不同应用场景的定制化需求。

## 系统架构特点

**模块化设计：**

每个功能模块通过清晰的接口进行交互，支持独立升级和维护。严格的初始化顺序确保系统稳定启动。

**事件驱动机制：**

基于发布-订阅模式实现模块间通信，支持异步任务处理。避免阻塞操作，提高系统响应速度。

**配置化管理：**

所有参数支持远程配置和持久化存储，提供灵活的协议适配能力。满足工业应用的高可靠性要求。

**容错处理：**

完善的异常处理机制，包括网络自动重连、硬件看门狗和故障恢复。确保系统在恶劣环境下的稳定运行。

这种架构设计确保了系统的稳定性、可扩展性和可维护性，为工业物联网应用提供了可靠的技术基础。
